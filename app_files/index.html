<!DOCTYPE html>
<html>
  <head>
  	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  	<link rel="stylesheet" href="static/chosen.min.css"/>
  	<link rel="stylesheet" href="static/style.css"/>
  	<link rel="stylesheet" href="static/prism.css"/>

  </head>

  <style>

  body {
  	background-image: url("/static/wine_background.jpg");
  }

  h2{
  	background-color: rgba(255,255,255,0.7);
	text-align: center;
	margin-top: 20px;
	margin-bottom: 30px;
	font-size: 80px;
	color:#800000;
	font-family: -webkit-body;
  }

  em{
  	margin-left: 50px;
  	font-family: Arial;
  	font-size: 150%;
  }

  .btn-primary{
  	background-color: #990000;
  	margin-bottom: 30px;
  }

  .btn-group{
	  margin: 0 auto;
	  width: 260px;
	  display: block;
  }

  #full-results-left {
	  background-color: rgba(255,255,255,0.7);
	  width: 460px;
	  padding: 20px 0 0 0;
	  border-radius: 5px;
	  position: absolute;
	  display:none;
	  top: 120px;
	  left: 10px;
	  font-family: -webkit-body;
  }

  #full-results-right {
	  background-color: rgba(255,255,255,0.7);
	  width: 460px;
	  padding: 20px 0 0 0;
	  border-radius: 5px;
	  position: absolute;
	  display:none;
	  top: 120px;
	  right: 10px;
	  font-family: -webkit-body;
  }

  #flavors-pairings{
  	position: absolute;
  	margin-left: 800px;
  }

  .flavors {
	  margin: 0 auto;
	  width: 300px;
	  display: none;
	  /*display: block;*/
	  clear: both;
	  background-color: rgba(255,255,255,0.7);
  	  color:#800000
  }

  .reviews {
	  background-color:#EEE;
	  border:1px solid #999999;
	  cursor:default;
	  display:none;
	  margin-top: 15px;
	  position:absolute;
	  overflow-y: scroll;
	  text-align:left;
	  width:394px;
	  height:200px;
	  z-index:50;
	  padding: 25px 25px 20px;
  }

  .reviews.div {
	  border-bottom: 1px solid #EFEFEF;
	  margin: 8px 0;
	  padding-bottom: 8px;
  }
    
  #find-buttons {
	  width: 200px;
	  display: block;
	  margin: 10px auto;
	  clear: both;
	  display: none;
	}
	#find-buttons > div {
	  width: 100px;
	  float: left;
	}

	#find-buttons > div > button {
		width: 80px;
	}

  </style>

  <body>
  	<div class="top">
  		<div id="title" class="wrapper">
	    <h2>Flavor Fave</h2>
	    </div>


	    <div class="btn-group" data-toggle="buttons">
  			<label class="btn btn-primary btn-lg">
    		<input type="radio" name="options" id="redwine" value='red' data-size="large"> Red Wines
  			</label>
  			<label class="btn btn-primary btn-lg">
    		<input type="radio" name="options" id="whitewine" value='white'> White Wines
  			</label>
		</div>
	    <div class="side-by-side clearfix">
		    <div class="flavors" id="red-flavors">
	          <em >Red Wine Flavors</em>
	          <select data-placeholder="Flavors" style="width:300px;" class="chosen-select" multiple tabindex="6">
	            <option value=""></option>
	            <optgroup label="FRUIT">
	              <option>Strawberry</option>
	              <option>Raspberry</option>
	              <option>Blackberry</option>
	              <option>Cherry</option>
	              <option>Blueberry</option>
	            </optgroup>
	            <optgroup label="SWEET/SALTY">
	              <option>Caramel</option>
	              <option>Toffee</option>
	              <option>Raisin</option>
	              <option>Licorice</option>
	              <option>Mocha</option>
	             <optgroup label="OTHER">
	              <option>Leather</option>
	              <option>Cedar</option>
	              <option>Coffee</option>
	              <option>Spice</option>
	            </optgroup>
	          </select>
	        </div>
	        <div class="flavors" id="white-flavors">
	          <em >White Wine Flavors</em>
	          <select data-placeholder="Flavors" style="width:300px;" class="chosen-select" multiple tabindex="6">
	            <option value=""></option>
	            <optgroup label="FRUIT">
	              <option>Lemon</option>
	              <option>Lime</option>
	              <option>Peach</option>
	              <option>Grapefruit</option>
	              <option>Orange</option>
	              <option>Apple</option>
	              <option>Melon</option>
	              <option>Pineapple</option>
	              <option>Watermelon</option>
	            </optgroup>
	            <optgroup label="SWEET/TART">
	              <option>Vanilla</option>
	              <option>Apricot</option>
	              <option>Citrus</option>
	  			  <option>Tropical</option>
	  			  <option>Stone</option>
	  			  <option>Creamy</option>
	  			  <option>Butter</option>
	  			  <option>Spice</option>
	            </optgroup>
	          </select>
	        </div>
		    <div id="find-buttons">
		        <div style="padding-top:15px; padding-bottom:5px;">
		          <button type="button" id="wine-button" class="btn btn-primary btn-sm">Find Wines</button>
		      	</div>
		      	<div style="padding-top:15px; padding-bottom:5px;">
		          <button type="button" id="reset-button" class="btn btn-primary btn-sm">Clear</button>
		        </div>
		    </div>
        </div>
    </div>
    <div id="full-results-left">
		<div style="font-size:18px;" class="side-by-side clearfix"> 
			<div>			
				<div style="padding-left:50px;" id="wine0">
	 				<span id="name0"></span>
	 				<span id="variety0"></span>
	 				<span id="points0"></span>
	 				<div class="reviews pop" id="reviews0">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="review0"></span>
	 				<span id="price0"></span><br><br>
	 			</div>
	 			<div style="padding-left:50px;" id="wine1">
	 				<span id="name1"></span>
	 				<span id="variety1"></span>
	 				<span id="points1"></span>
	 				<div class="reviews pop" id="reviews1">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="review1"></span>
	 				<span id="price1"></span><br><br>
				</div>
				<div style="padding-left:50px;" id="wine2">
					<span id="name2"></span>
	 				<span id="variety2"></span>
	 				<span id="points2"></span>
	 				<div class="reviews pop" id="reviews2">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="review2"></span>
	 				<span id="price2"></span><br><br>
				</div>		
				<div style="padding-left:50px;" id="wine3">
					<span id="name3"></span>
	 				<span id="variety3"></span>
	 				<span id="points3"></span>
	 				<div class="reviews pop" id="reviews3">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="review3"></span>
	 				<span id="price3"></span><br><br>
				</div>
				<div style="padding-left:50px;" id="wine4">
					<span id="name4"></span>
	 				<span id="variety4"></span>
	 				<span id="points4"></span>
	 				<div class="reviews pop" id="reviews4">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="review4"></span>
	 				<span id="price4"></span><br><br>
				</div>
			</div>
		</div>
	</div>

	<div id="full-results-right">
		<div style="font-size:18px;" class="side-by-side clearfix"> 
			<div>			
				<div style="padding-left:50px;" id="pwine0">
	 				<span id="pname0"></span>
	 				<span id="pvariety0"></span>
	 				<span id="ppoints0"></span>
	 				<div class="reviews pop" id="reviews0">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="preview0"></span>
	 				<span id="pprice0"></span><br><br>
	 			</div>
	 			<div style="padding-left:50px;" id="pwine1">
	 				<span id="pname1"></span>
	 				<span id="pvariety1"></span>
	 				<span id="ppoints1"></span>
	 				<div class="reviews pop" id="reviews1">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="preview1"></span>
	 				<span id="pprice1"></span><br><br>
				</div>
				<div style="padding-left:50px;" id="pwine2">
					<span id="pname2"></span>
	 				<span id="pvariety2"></span>
	 				<span id="ppoints2"></span>
	 				<div class="reviews pop" id="reviews2">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="preview2"></span>
	 				<span id="pprice2"></span><br><br>
				</div>		
				<div style="padding-left:50px;" id="pwine3">
					<span id="pname3"></span>
	 				<span id="pvariety3"></span>
	 				<span id="ppoints3"></span>
	 				<div class="reviews pop" id="reviews3">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="preview3"></span>
	 				<span id="pprice3"></span><br><br>
				</div>
				<div style="padding-left:50px;" id="pwine4">
					<span id="pname4"></span>
	 				<span id="pvariety4"></span>
	 				<span id="ppoints4"></span>
	 				<div class="reviews pop" id="reviews4">
	 				</div>
	 				<span class="review_button" style="text-decoration: underline;" id="preview4"></span>
	 				<span id="pprice4"></span><br><br>
				</div>
			</div>
		</div>
	</div>



	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" type="text/javascript"></script>
	<script scr="http://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="static/chosen.jquery.min.js" type="text/javascript" ></script>
	<script src="static/prism.js" type="text/javascript" ></script>
	<script type="text/javascript">

		var config = {
      		'.chosen-select'           : {},
      		'.chosen-select-deselect'  : {allow_single_deselect:true},
      		'.chosen-select-no-single' : {disable_search_threshold:10},
      		'.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
      		'.chosen-select-width'     : {width:"95%"}
    	}

    	for (var selector in config) {
      		$(selector).chosen(config[selector]);
	    }	

	    $('.btn').button();

	    $('#wine-button').on('click', function () {
	    	get_wines();
	    	$(".btn-group button").removeClass("active");
	    });


	    $('#reset-button').on('click', function () {
	    	$(".chosen-select").val('').trigger("chosen:updated");
	    	$('#full-results-left').hide();
	    	$('#full-results-right').hide();
	    });


	    $('input:radio[name="options"]').change(function(){
	    	if($(this).val() === 'red'){
	    		$('#red-flavors').css('display', 'block');
	    		$('#find-buttons').css('display', 'block')
	    		$('#white-flavors').css('display', 'none');
	    }
	    	else{
	    		$('#red-flavors').css('display', 'none');
	    		$('#find-buttons').css('display', 'block')
	    		$('#white-flavors').css('display', 'block');
	    	}
	    })

             
		function get_wines(){


			if ($('.flavors').find(".chosen-choices").text().length == 0){
				wine_features = $('#flavors-pairings').find(".chosen-single").text();
			}
			else {
				wine_features = $('.flavors').find(".chosen-choices").text();
			};

			pair1 = ['Raspberry', 'Strawberry', 'Tart', 'Cranberry', 'Cola'];
			pair2 = ['Blueberry', 'Licorice', 'Jammy', 'Smoke'];
			pair3 = ['Blackberry', 'Tobacco', 'Coffee'];
			pair4 = ['Citrus', 'Lemon', 'Peach', 'Melon', 'Tropical'];
			pair5 = ['Orange', 'Caramel', 'Apricot'];
			pair6 = ['Vanilla', 'Oak', 'Pineapple', 'Butter'];
			
			pair_array = [pair1, pair2, pair3, pair4, pair5, pair6];

			pairings = {pair1: 'Rasbperry Strawberry Tart Cranberry Cola', pair2: 'Cassis, Cedar, Tobacco, Leather, Coffee',
						pair3: 'Blackberry, Tobacco, Coffee', pair4: 'Citrus, Lemon, Peach, Melon, Tropical', 
						pair5: 'Orange, Caramel, Apricot', pair6: 'Vanilla, Oak, Pineapple, Butter'};

			if ($.inArray(wine_features, pair1)){;
				flavor_pair = pairings.pair1;
			};
			if ($.inArray(wine_features, pair2)){
				flavor_pair = pairings.pair2;
			};
			if ($.inArray(wine_features, pair3)){
				flavor_pair = pairings.pair3;
			};

			console.log(wine_features)

			descriptors = JSON.stringify({descriptions: wine_features, pair_desc: flavor_pair});
			//console.log(descriptors);

            $.ajax({
     		type: "POST",
     		contentType: "application/json; charset=utf-8",
     		url: "/wines",
     		dataType: "json",
     		async: true,
     		data: descriptors,
     		success: function (data) {

     			$('#full-results-left').show();
     			$('#full-results-right').show();

     			for (var i = 0; i < 5; i++){
	     			$("#name" + i).html(data['wine'][i]['wine/name'] + "<br>");
	     			$("#variety" + i).html(data['wine'][i]['wine/variant'] + "<br>");
	     			$("#points" + i).html(data['wine'][i]['review/points'] + "<br>");
	     			$("#review" + i).html('Review' + "<br>");
	     			$("#price" + i).html(data['wine'][i]['food_pairing'] + "<br>");
	     			//$("#price" + i).html('Price: ' + data['wine'][i]['price'] + "<br>");

	     			$("#pname" + i).html(data['pairing'][i]['wine/name'] + "<br>");
	     			$("#pvariety" + i).html(data['pairing'][i]['wine/variant'] + "<br>");
	     			$("#ppoints" + i).html(data['pairing'][i]['review/points'] + "<br>");
	     			$("#preview" + i).html('Review' + "<br>");
	     			$("#pprice" + i).html(data['pairing'][i]['food_pairing'] + "<br>");
	     		}; 

     			function deselect(e) {
     			  var review_id = e.prev().attr('id');
				  $('#' + review_id).slideFadeToggle(function() {
				    e.removeClass('selected');
				  });    
				}

				
				$(function() {
				  $('.review_button').on('click', function() {
				    if($(this).hasClass('selected')) {
				      deselect($(this));               
				    } else {
				      var review_id = $(this).prev().attr('id');
				      var lastChar = review_id.substr(review_id.length - 1);
				      $(this).addClass('selected');
				      $('#' + review_id).slideFadeToggle();
				      $('#' + review_id).html(data['wine'][lastChar]['review/text']);
				    }
				    return false;
				  });

				  $('.close').on('click', function(){
				  	var review_id = $(this).prev().attr('id');
				    deselect($(this));
				    return false;
				  });
				});

				$.fn.slideFadeToggle = function(easing, callback) {
				  return this.animate({ opacity: 'toggle', height: 'toggle' }, 'fast', easing, callback);
				};

     		},
     		error: function (result) {
         		console.log(result);}
       		})
        };

	</script>
   </body>
</html>